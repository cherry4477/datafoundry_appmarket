image: golang:1.6.0
services:
  - mysql
env:
  - MYSQL_PORT_3306_TCP_ADDR=$MYSQL_PORT_3306_TCP_ADDR
  - MYSQL_PORT_3306_TCP_PORT=$MYSQL_PORT_3306_TCP_PORT
  - MYSQL_ENV_MYSQL_DATABASE=test
  - MYSQL_ENV_MYSQL_USER=root
  - MYSQL_ENV_MYSQL_PASSWORD=
  - MYSQL_CONFIG_DONT_UPGRADE_TABLES=yes
before_script:
  - mkdir -p /daocloud/builder/tmp
  - mv -f /daocloud/builder/src/* /daocloud/builder/tmp
  - mkdir -p /daocloud/builder/src/github.com/asiainfoLDP
  - mv -f /daocloud/builder/tmp /daocloud/builder/src/github.com/asiainfoLDP/datahub_stars
  - cd /daocloud/builder/src/github.com/asiainfoLDP/datahub_stars && ls -ll
script:
  - export GOPATH=/daocloud/builder
  - cd /daocloud/builder/src/github.com/asiainfoLDP/datahub_stars
  - _db/db_init_daocloud_ut.sh
  - go test -v -cover $(go list ./... | grep -v /vendor/)

